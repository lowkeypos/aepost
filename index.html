<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tattoo CRM | Панель керування</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sidebar-nav a.active {
            background: rgba(255, 255, 255, 0.1);
            border-left: 3px solid #f59e0b;
        }
        .appointment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .material-enter {
            animation: materialEnter 0.5s ease-out;
        }
        @keyframes materialEnter {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex overflow-hidden">
    <!-- Мобильное меню -->
    <div id="mobileMenu" class="md:hidden fixed inset-0 bg-gray-900 z-50 hidden">
        <div class="p-4">
            <button onclick="toggleMobileMenu()" class="mb-6">
                <i class="fas fa-times text-2xl"></i>
            </button>
            <div class="space-y-2">
                <a href="#dashboard" onclick="showSection('dashboard'), toggleMobileMenu()" class="block px-4 py-2 rounded hover:bg-gray-800">Дашборд</a>
                <a href="#appointments" onclick="showSection('appointments'), toggleMobileMenu()" class="block px-4 py-2 rounded hover:bg-gray-800">Записи</a>
                <a href="#clients" onclick="showSection('clients'), toggleMobileMenu()" class="block px-4 py-2 rounded hover:bg-gray-800">Клієнти</a>
                <a href="#inventory" onclick="showSection('inventory'), toggleMobileMenu()" class="block px-4 py-2 rounded hover:bg-gray-800">Матеріали</a>
                <a href="#finance" onclick="showSection('finance'), toggleMobileMenu()" class="block px-4 py-2 rounded hover:bg-gray-800">Фінанси</a>
                <a href="#settings" onclick="showSection('settings'), toggleMobileMenu()" class="block px-4 py-2 rounded hover:bg-gray-800">Налаштування</a>
                <button onclick="logout()" class="block w-full text-left px-4 py-2 rounded hover:bg-gray-800 text-red-400">Вийти</button>
            </div>
        </div>
    </div>

    <!-- Боковая панель -->
    <div class="hidden md:flex md:flex-shrink-0">
        <div class="flex flex-col w-64 bg-gray-800 border-r border-gray-700">
            <div class="h-16 flex items-center px-4 border-b border-gray-700">
                <h1 class="text-xl font-bold text-amber-400">Tattoo CRM</h1>
            </div>
            <div class="flex flex-col flex-grow pt-4 overflow-y-auto">
                <nav class="flex-1 space-y-1 sidebar-nav">
                    <a href="#dashboard" onclick="showSection('dashboard')" class="block px-4 py-2 text-sm rounded mx-2 active"><i class="fas fa-chart-line mr-3"></i> Дашборд</a>
                    <a href="#appointments" onclick="showSection('appointments')" class="block px-4 py-2 text-sm rounded mx-2"><i class="fas fa-calendar-alt mr-3"></i> Записи</a>
                    <a href="#clients" onclick="showSection('clients')" class="block px-4 py-2 text-sm rounded mx-2"><i class="fas fa-users mr-3"></i> Клієнти</a>
                    <a href="#inventory" onclick="showSection('inventory')" class="block px-4 py-2 text-sm rounded mx-2"><i class="fas fa-boxes mr-3"></i> Матеріали</a>
                    <a href="#finance" onclick="showSection('finance')" class="block px-4 py-2 text-sm rounded mx-2"><i class="fas fa-money-bill-wave mr-3"></i> Фінанси</a>
                    <a href="#settings" onclick="showSection('settings')" class="block px-4 py-2 text-sm rounded mx-2"><i class="fas fa-cog mr-3"></i> Налаштування</a>
                </nav>
            </div>
            <div class="p-4 border-t border-gray-700">
                <button onclick="logout()" class="flex items-center w-full px-2 py-2 text-sm rounded hover:bg-gray-700 text-red-400">
                    <i class="fas fa-sign-out-alt mr-3"></i> Вийти
                </button>
            </div>
        </div>
    </div>

    <!-- Основное содержимое -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Верхняя панель -->
        <div class="h-16 flex items-center justify-between px-4 border-b border-gray-700 bg-gray-800">
            <button onclick="toggleMobileMenu()" class="md:hidden">
                <i class="fas fa-bars text-xl"></i>
            </button>
            <div class="flex items-center space-x-4">
                <div class="hidden md:block relative">
                    <button onclick="toggleSearch()" class="flex items-center px-3 py-1 bg-gray-700 rounded-md">
                        <i class="fas fa-search mr-2 text-gray-400"></i>
                        <span class="text-gray-300 text-sm">Пошук...</span>
                    </button>
                    <div id="searchDropdown" class="absolute right-0 mt-2 w-64 bg-gray-800 rounded-md shadow-lg hidden z-10 p-2 border border-gray-700">
                        <input type="text" placeholder="Введіть запит..." class="w-full bg-gray-700 rounded px-2 py-1 text-sm mb-2">
                        <div class="text-xs text-gray-400">Пошук клієнтів, записів, матеріалів...</div>
                    </div>
                </div>
                <div class="relative">
                    <button class="p-1 rounded-full hover:bg-gray-700 relative">
                        <i class="fas fa-bell text-lg"></i>
                        <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">3</span>
                    </button>
                </div>
                <div class="flex items-center">
                    <div class="h-8 w-8 rounded-full bg-amber-500 flex items-center justify-center text-sm font-semibold">TM</div>
                    <span class="ml-2 text-sm hidden md:inline">Tattoo Master</span>
                </div>
            </div>
        </div>

        <!-- Контент страницы -->
        <div class="flex-1 overflow-y-auto p-4 bg-gray-900">
            <!-- Дашборд -->
            <div id="dashboard" class="section-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Дашборд</h2>
                    <div class="flex space-x-2">
                        <button class="px-3 py-1 bg-gray-800 rounded text-sm border border-gray-700 hover:bg-gray-700">Сьогодні</button>
                        <button class="px-3 py-1 bg-gray-800 rounded text-sm border border-gray-700 hover:bg-gray-700">Тиждень</button>
                        <button class="px-3 py-1 bg-gray-800 rounded text-sm border border-gray-700 hover:bg-gray-700">Місяць</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Дохід</p>
                                <h3 class="text-xl font-semibold text-amber-400">0 грн</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-amber-500/20 flex items-center justify-center">
                                <i class="fas fa-money-bill-wave text-amber-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">+0% з минулого місяця</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Клієнти</p>
                                <h3 class="text-xl font-semibold">0</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-blue-500/20 flex items-center justify-center">
                                <i class="fas fa-users text-blue-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">+0 нових</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Сеанси</p>
                                <h3 class="text-xl font-semibold">0</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-green-500/20 flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-green-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">0 заплановано</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Матеріали</p>
                                <h3 class="text-xl font-semibold">0</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-purple-500/20 flex items-center justify-center">
                                <i class="fas fa-boxes text-purple-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">0 закінчується</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 lg:col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-medium">Дохід за останні 30 днів</h3>
                            <select class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm">
                                <option>30 днів</option>
                                <option>12 місяців</option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="incomeChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <h3 class="font-medium mb-4">Найближчі сеанси</h3>
                        <div id="upcomingAppointments" class="space-y-3">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-calendar-alt text-4xl mb-2"></i>
                                <p>Немає запланованих сеансів</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <h3 class="font-medium mb-4">ТОП клієнти</h3>
                        <div id="topClients" class="text-center py-8 text-gray-500">
                            <i class="fas fa-users text-4xl mb-2"></i>
                            <p>Немає даних про клієнтів</p>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <h3 class="font-medium mb-4">Споживання матеріалів</h3>
                        <div id="materialUsage" class="text-center py-8 text-gray-500">
                            <i class="fas fa-box-open text-4xl mb-2"></i>
                            <p>Немає даних про використання</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Записи -->
            <div id="appointments" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Записи</h2>
                    <div class="flex space-x-3">
                        <div class="relative">
                            <button onclick="toggleDateFilter()" class="flex items-center px-3 py-1 bg-gray-800 rounded text-sm border border-gray-700 hover:bg-gray-700">
                                <i class="fas fa-calendar-alt mr-2"></i>
                                <span id="dateFilterText">Усі дати</span>
                                <i class="fas fa-chevron-down ml-2 text-xs"></i>
                            </button>
                            <div id="dateFilterDropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg hidden z-10 p-2 border border-gray-700">
                                <div class="text-gray-400 text-xs mb-1">Фільтр за датою</div>
                                <button onclick="setDateFilter('all')" class="block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm">Усі дати</button>
                                <button onclick="setDateFilter('today')" class="block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm">Сьогодні</button>
                                <button onclick="setDateFilter('week')" class="block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm">Цей тиждень</button>
                                <button onclick="setDateFilter('month')" class="block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm">Цей місяць</button>
                                <div class="border-t border-gray-700 my-1"></div>
                                <button onclick="showCustomDateRange()" class="block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm">Свій діапазон...</button>
                            </div>
                        </div>
                        <button onclick="showAddAppointmentModal()" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                            <i class="fas fa-plus mr-1"></i> Додати запис
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="appointmentsList">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-calendar-alt text-4xl mb-3"></i>
                        <h3 class="text-lg mb-1">Немає записів</h3>
                        <p class="mb-4 text-sm">Створіть перший запис клієнта</p>
                        <button onclick="showAddAppointmentModal()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                            <i class="fas fa-plus mr-1"></i> Додати запис
                        </button>
                    </div>
                </div>
            </div>

            <!-- Клієнти -->
            <div id="clients" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Клієнти</h2>
                    <button onclick="showAddClientModal()" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                        <i class="fas fa-plus mr-1"></i> Додати клієнта
                    </button>
                </div>

                <div class="relative overflow-x-auto shadow-md rounded-lg border border-gray-700">
                    <table class="w-full text-sm text-left text-gray-400">
                        <thead class="text-xs text-gray-300 uppercase bg-gray-800">
                            <tr>
                                <th scope="col" class="px-6 py-3">Ім'я</th>
                                <th scope="col" class="px-6 py-3">Контакти</th>
                                <th scope="col" class="px-6 py-3">Сеанси</th>
                                <th scope="col" class="px-6 py-3">Останній візит</th>
                                <th scope="col" class="px-6 py-3">Дії</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                    <div class="py-8">
                                        <i class="fas fa-users text-4xl mb-2"></i>
                                        <p>База клієнтів порожня</p>
                                        <button onclick="showAddClientModal()" class="mt-3 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                                            <i class="fas fa-plus mr-1"></i> Додати клієнта
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Матеріали -->
            <div id="inventory" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Матеріали</h2>
                    <div class="flex space-x-3">
                        <div class="relative">
                            <button onclick="toggleInventoryFilter()" class="flex items-center px-3 py-1 bg-gray-800 rounded text-sm border border-gray-700 hover:bg-gray-700">
                                <span id="inventoryFilterText">Усі категорії</span>
                                <i class="fas fa-chevron-down ml-2 text-xs"></i>
                            </button>
                            <div id="inventoryFilterDropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg hidden z-10 p-2 border border-gray-700">
                                <div class="text-gray-400 text-xs mb-1">Фільтр за категорією</div>
                                <button onclick="setInventoryFilter('all')" class="block w-full text-left px-2 py-1 rounded hover:bg-gray-700 text-sm">Усі категорії</button>
                                <div id="inventoryCategoriesFilter"></div>
                            </div>
                        </div>
                        <button onclick="showAddMaterialModal()" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                            <i class="fas fa-plus mr-1"></i> Додати матеріал
                        </button>
                    </div>
                </div>

                <div class="mb-4 flex justify-between items-center">
                    <div class="text-sm text-gray-400">
                        Показано <span id="materialsCount">0</span> матеріалів
                    </div>
                    <div>
                        <input type="text" id="materialSearch" placeholder="Пошук матеріалів..." class="bg-gray-800 border border-gray-700 rounded px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                </div>

                <div class="relative overflow-x-auto shadow-md rounded-lg border border-gray-700">
                    <table class="w-full text-sm text-left text-gray-400">
                        <thead class="text-xs text-gray-300 uppercase bg-gray-800">
                            <tr>
                                <th scope="col" class="px-6 py-3">Назва</th>
                                <th scope="col" class="px-6 py-3">Категорія</th>
                                <th scope="col" class="px-6 py-3">Кількість</th>
                                <th scope="col" class="px-6 py-3">Ціна</th>
                                <th scope="col" class="px-6 py-3">Дії</th>
                            </tr>
                        </thead>
                        <tbody id="materialsTableBody">
                            <tr>
                                <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                    <div class="py-8">
                                        <i class="fas fa-box-open text-4xl mb-2"></i>
                                        <p>Немає матеріалів на складі</p>
                                        <button onclick="showAddMaterialModal()" class="mt-3 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                                            <i class="fas fa-plus mr-1"></i> Додати матеріал
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 text-xs text-gray-500">
                    <i class="fas fa-info-circle mr-1"></i> Двайте клік по матеріалу для швидкого редагування
                </div>
            </div>

            <!-- Фінанси -->
            <div id="finance" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Фінанси</h2>
                    <div class="flex space-x-3">
                        <button onclick="showAddExpenseModal()" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">
                            <i class="fas fa-minus mr-1"></i> Додати витрату
                        </button>
                        <button onclick="showIncomeReportModal()" class="px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded text-sm border border-gray-700">
                            <i class="fas fa-chart-pie mr-1"></i> Звіт
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Дохід (за місяць)</p>
                                <h3 class="text-xl font-semibold text-green-500">0 грн</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-green-500/20 flex items-center justify-center">
                                <i class="fas fa-arrow-up text-green-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">+0% з минулого місяця</p>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Витрати (за місяць)</p>
                                <h3 class="text-xl font-semibold text-red-500">0 грн</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-red-500/20 flex items-center justify-center">
                                <i class="fas fa-arrow-down text-red-500"></i>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-2">
                            <p class="text-xs text-gray-400">+0% з минулого місяця</p>
                            <button onclick="showAddExpenseModal()" class="text-xs px-2 py-0.5 bg-red-600 hover:bg-red-700 rounded">
                                Додати
                            </button>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-gray-400 text-sm">Прибуток</p>
                                <h3 class="text-xl font-semibold text-amber-400">0 грн</h3>
                            </div>
                            <div class="h-10 w-10 rounded-full bg-amber-500/20 flex items-center justify-center">
                                <i class="fas fa-chart-line text-amber-500"></i>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">Рентабельність: 0%</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-medium">Дохід vs Витрати</h3>
                            <select class="bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm">
                                <option>12 місяців</option>
                                <option>6 місяців</option>
                                <option>3 місяці</option>
                            </select>
                        </div>
                        <div class="h-64">
                            <canvas id="incomeVsExpensesChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                        <h3 class="font-medium mb-4">Останні операції</h3>
                        <div class="space-y-3" id="lastTransactions">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-exchange-alt text-4xl mb-2"></i>
                                <p>Немає фінансових операцій</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-medium">Категорії витрат</h3>
                    </div>
                    <div class="h-64">
                        <canvas id="expensesByCategoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Налаштування -->
            <div id="settings" class="section-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Налаштування</h2>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 mb-6">
                            <h3 class="font-medium mb-4">Основні налаштування</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Почасова ставка (грн)</label>
                                    <input type="number" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500" value="1000">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Валюта</label>
                                    <select class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                        <option>Гривня (грн)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Мова інтерфейсу</label>
                                    <select class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                        <option>Українська</option>
                                        <option>Русский</option>
                                        <option>English</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-400 mb-1">Формат дати</label>
                                    <select class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                        <option>ДД.ММ.РРРР</option>
                                        <option>РРРР-ММ-ДД</option>
                                    </select>
                                </div>
                            </div>
                            <button class="mt-4 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded">Зберегти налаштування</button>
                        </div>

                        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                            <h3 class="font-medium mb-4">Категорії витрат</h3>
                            <div id="expenseCategoriesList" class="mb-4 space-y-2">
                                <div class="flex justify-between items-center bg-gray-700 p-2 rounded">
                                    <div>
                                        <span class="font-medium">Матеріали</span>
                                        <span class="text-xs text-gray-400 ml-2">5 витрат</span>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button class="text-gray-400 hover:text-white">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="text-red-400 hover:text-red-300">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="flex">
                                <input type="text" placeholder="Назва нової категорії" class="flex-1 bg-gray-700 border border-gray-600 rounded-l px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                <button class="px-3 py-2 bg-amber-600 hover:bg-amber-700 rounded-r">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700 mb-6">
                            <h3 class="font-medium mb-4">Категорії матеріалів</h3>
                            <div id="materialCategoriesList" class="mb-4 space-y-2">
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-tags text-4xl mb-2"></i>
                                    <p>Немає категорій</p>
                                </div>
                            </div>
                            <div class="flex">
                                <input type="text" placeholder="Назва нової категорії" class="flex-1 bg-gray-700 border border-gray-600 rounded-l px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                <button class="px-3 py-2 bg-amber-600 hover:bg-amber-700 rounded-r">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                            <h3 class="font-medium mb-4">Експорт даних</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-2 hover:bg-gray-700 rounded">
                                    <div>
                                        <i class="fas fa-file-excel text-green-500 mr-2"></i>
                                        <span>Експорт у Excel</span>
                                    </div>
                                    <button class="text-sm px-3 py-1 bg-green-800 hover:bg-green-700 rounded">Експорт</button>
                                </div>
                                <div class="flex items-center justify-between p-2 hover:bg-gray-700 rounded">
                                    <div>
                                        <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                                        <span>Експорт у PDF</span>
                                    </div>
                                    <button class="text-sm px-3 py-1 bg-red-800 hover:bg-red-700 rounded">Експорт</button>
                                </div>
                                <div class="flex items-center justify-between p-2 hover:bg-gray-700 rounded">
                                    <div>
                                        <i class="fas fa-database text-amber-500 mr-2"></i>
                                        <span>Резервна копія</span>
                                    </div>
                                    <button class="text-sm px-3 py-1 bg-amber-800 hover:bg-amber-700 rounded">Створити</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Сессия/Калькулятор (скрытый до вызова) -->
    <div id="sessionSection" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg border border-gray-700 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Калькулятор сеансу</h3>
                <button onclick="hideSessionCalculator()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Клієнт</label>
                        <div class="bg-gray-700 px-3 py-2 rounded border border-gray-600">
                            <span id="sessionClientName">Олег Коваленко</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Дата</label>
                        <div class="bg-gray-700 px-3 py-2 rounded border border-gray-600">
                            <span id="sessionDate">15.07.2023</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Час початку</label>
                        <div class="bg-gray-700 px-3 py-2 rounded border border-gray-600">
                            <span id="sessionTime">14:00</span>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-700 rounded-lg p-4 mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Тривалість (год)</label>
                            <input type="number" id="sessionDuration" min="0.5" step="0.5" class="w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500" value="2">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Ставка (грн/год)</label>
                            <div class="bg-gray-800 px-3 py-2 rounded border border-gray-600">
                                <span>1000</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Складність (1-10)</label>
                            <select id="sessionComplexity" class="w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5" selected>5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Націнка</label>
                            <div id="sessionComplexityFee" class="bg-gray-800 px-3 py-2 rounded border border-gray-600">
                                <span>0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="font-medium mb-2">Використані матеріали</h4>
                    <div id="sessionMaterialsList" class="mb-2">
                        <div class="text-center py-4 text-gray-500">
                            <p>Матеріали не вибрані</p>
                        </div>
                    </div>
                    <button onclick="showAddSessionMaterialModal()" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">
                        <i class="fas fa-plus mr-1"></i> Додати матеріал
                    </button>
                </div>

                <div class="bg-gray-900 rounded-lg p-4 mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="space-y-1">
                            <div class="text-sm text-gray-400">Сума за час</div>
                            <div class="text-xl" id="sessionTimeCost">2000 грн</div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-sm text-gray-400">Націнка за складність</div>
                            <div class="text-xl" id="sessionComplexityCost">0 грн</div>
                        </div>
                        <div class="space-y-1">
                            <div class="text-sm text-gray-400">Матеріали</div>
                            <div class="text-xl" id="sessionMaterialsCost">0 грн</div>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-800 flex justify-between items-center">
                        <div>
                            <div class="text-sm text-gray-400">Разом до сплати</div>
                            <div class="text-2xl font-bold text-amber-400" id="sessionTotalCost">2000 грн</div>
                        </div>
                        <div class="flex space-x-2">
                            <select id="paymentMethod" class="bg-gray-800 border border-gray-700 rounded px-3 py-1 text-sm">
                                <option value="cash">Готівка</option>
                                <option value="card">Карта</option>
                                <option value="transfer">Переказ</option>
                            </select>
                            <button onclick="completeSessionPayment()" class="px-4 py-1 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                                <i class="fas fa-check mr-1"></i> Оплата
                            </button>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm text-gray-400 mb-1">Примітки</label>
                    <textarea id="sessionNotes" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 h-20 focus:outline-none focus:ring-1 focus:ring-amber-500"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div id="addAppointmentModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-md">
            <div class="border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Новий запис</h3>
                <button onclick="hideModal('addAppointmentModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Клієнт</label>
                        <select id="appointmentClient" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                            <option value="">Вибрати клієнта...</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Дата</label>
                            <input type="date" id="appointmentDate" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Час</label>
                            <input type="time" id="appointmentTime" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Тривалість</label>
                        <select id="appointmentDuration" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                            <option value="1">1 година</option>
                            <option value="1.5">1.5 години</option>
                            <option value="2">2 години</option>
                            <option value="2.5">2.5 години</option>
                            <option value="3">3 години</option>
                            <option value="4">4 години</option>
                            <option value="5">5 годин</option>
                            <option value="6">6 годин</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Очікувана складність</label>
                        <select id="appointmentComplexity" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                            <option value="1">1 - Дуже легкий</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5" selected>5 - Середній</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10 - Найскладніший</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Примітки</label>
                        <textarea id="appointmentNotes" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 h-20 focus:outline-none focus:ring-1 focus:ring-amber-500"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button onclick="hideModal('addAppointmentModal')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">Скасувати</button>
                    <button onclick="saveAppointment()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">Зберегти запис</button>
                </div>
            </div>
        </div>
    </div>

    <div id="addClientModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-md">
            <div class="border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Новий клієнт</h3>
                <button onclick="hideModal('addClientModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Ім'я</label>
                            <input type="text" id="clientFirstName" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Прізвище</label>
                            <input type="text" id="clientLastName" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Телефон</label>
                        <input type="tel" id="clientPhone" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email</label>
                        <input type="email" id="clientEmail" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Соцмережі</label>
                        <input type="text" id="clientSocials" placeholder="Instagram, Facebook, etc." class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Примітки</label>
                        <textarea id="clientNotes" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 h-20 focus:outline-none focus:ring-1 focus:ring-amber-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Мітки</label>
                        <div class="flex flex-wrap gap-2" id="clientTagsContainer">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-700 text-gray-300">
                                Новий клієнт
                                <button type="button" class="ml-1 text-gray-400 hover:text-gray-200">
                                    <span class="sr-only">Remove</span>
                                    <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </span>
                        </div>
                        <div class="mt-2 flex">
                            <input type="text" id="newClientTag" placeholder="Нова мітка" class="flex-1 bg-gray-700 border border-gray-600 rounded-l px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-amber-500">
                            <button onclick="addClientTag()" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded-r text-sm">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button onclick="hideModal('addClientModal')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">Скасувати</button>
                    <button onclick="saveClient()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">Зберегти клієнта</button>
                </div>
            </div>
        </div>
    </div>

    <div id="addMaterialModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-md">
            <div class="border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Новий матеріал</h3>
                <button onclick="hideModal('addMaterialModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Назва</label>
                        <input type="text" id="materialName" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Категорія</label>
                            <select id="materialCategory" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                <option value="">Без категорії</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Кількість</label>
                            <input type="number" id="materialQuantity" min="1" step="1" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Ціна за одиницю (грн)</label>
                        <input type="number" id="materialPrice" min="0" step="0.01" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Опис</label>
                        <textarea id="materialDescription" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 h-20 focus:outline-none focus:ring-1 focus:ring-amber-500"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button onclick="hideModal('addMaterialModal')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">Скасувати</button>
                    <button onclick="saveMaterial()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">Зберегти матеріал</button>
                </div>
            </div>
        </div>
    </div>

    <div id="addSessionMaterialModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-md">
            <div class="border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Додати матеріал</h3>
                <button onclick="hideModal('addSessionMaterialModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label class="block text-sm text-gray-400 mb-1">Матеріал</label>
                    <select id="sessionMaterialSelect" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        <option value="">Вибрати матеріал...</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Кількість</label>
                        <input type="number" id="sessionMaterialQuantity" min="1" step="1" value="1" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Ціна (грн)</label>
                        <input type="number" id="sessionMaterialPrice" min="0" step="0.01" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">Примітки</label>
                    <input type="text" id="sessionMaterialNotes" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button onclick="hideModal('addSessionMaterialModal')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">Скасувати</button>
                    <button onclick="addMaterialToSession()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">Додати</button>
                </div>
            </div>
        </div>
    </div>

    <div id="addExpenseModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-md">
            <div class="border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Нова витрата</h3>
                <button onclick="hideModal('addExpenseModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Сума (грн)</label>
                        <input type="number" id="expenseAmount" min="0" step="0.01" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Дата</label>
                            <input type="date" id="expenseDate" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-1">Категорія</label>
                            <select id="expenseCategory" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                                <option value="materials">Матеріали</option>
                                <option value="rent">Оренда</option>
                                <option value="marketing">Маркетинг</option>
                                <option value="equipment">Обладнання</option>
                                <option value="other">Інше</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Опис</label>
                        <input type="text" id="expenseDescription" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Спосіб оплати</label>
                        <select id="expensePaymentMethod" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-1 focus:ring-amber-500">
                            <option value="cash">Готівка</option>
                            <option value="card">Карта</option>
                            <option value="transfer">Переказ</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button onclick="hideModal('addExpenseModal')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">Скасувати</button>
                    <button onclick="saveExpense()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded text-sm">Додати витрату</button>
                </div>
            </div>
        </div>
    </div>

    <div id="incomeReportModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-4xl">
            <div class="border-b border-gray-700 p-4 flex justify-between items-center">
                <h3 class="text-lg font-semibold">Звіт про доходи</h3>
                <button onclick="hideModal('incomeReportModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gray-900 rounded-lg p-4">
                        <h4 class="font-medium mb-3">За період</h4>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-400">Сьогодні</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-400">Цей тиждень</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-400">Цей місяць</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Цей рік</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4">
                        <h4 class="font-medium mb-3">За способом оплати</h4>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-400">Готівка</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-400">Карта</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Переказ</span>
                            <span class="font-medium">0 грн</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium mb-3">ТОП клієнти</h4>
                        <div class="bg-gray-900 rounded-lg p-4">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-users text-4xl mb-2"></i>
                                <p>Немає даних</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-medium mb-3">Статистика сеансів</h4>
                        <div class="bg-gray-900 rounded-lg p-4">
                            <div class="text-center py-8 text-gray-500">
                                <i class="fas fa-chart-pie text-4xl mb-2"></i>
                                <p>Немає даних</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 p-4 flex justify-end">
                <button onclick="hideModal('incomeReportModal')" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm border border-gray-600">Закрити</button>
            </div>
        </div>
    </div>

    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl flex items-center">
            <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-amber-500 mr-4"></div>
            <span class="text-white">Завантаження...</span>
        </div>
    </div>

    <script>
        // Supabase клиент
        const supabaseUrl = 'https://iedrcmbvegttznaxpevd.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllZHJjbWJ2ZWd0dHpuYXhwZXZkIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0NzQwNDIzMSwiZXhwIjoyMDYyOTgwMjMxfQ.mMhJb_e5NGWELNbDyg3IVW2SiD9j6YmtXKcBwJevgl8';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Данные приложения
        let appData = {
            clients: [],
            appointments: [],
            materials: [],
            transactions: []
        };

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Проверка авторизации
            checkAuth();
            
            // Инициализация графиков
            initCharts();
            
            // Установка текущей даты по умолчанию для форм
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('appointmentDate').value = today;
            document.getElementById('expenseDate').value = today;
            
            // Переключение между разделами
            if (window.location.hash) {
                showSection(window.location.hash.substring(1));
            } else {
                showSection('dashboard');
            }
            
            // Инициализация слушателей событий
            setupEventListeners();
            
            // Загрузка данных
            loadInitialData();
        });

        // Функции авторизации
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                window.location.href = 'login.html';
            }
        }

        async function logout() {
            const { error } = await supabase.auth.signOut();
            window.location.href = 'login.html';
        }

        // Управление интерфейсом
        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Обновление активного пункта меню
            document.querySelectorAll('.sidebar-nav a').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`.sidebar-nav a[href="#${sectionId}"]`).classList.add('active');
            
            // Программная прокрутка к началу контента
            window.scrollTo(0, 0);
        }

        function toggleMobileMenu() {
            document.getElementById('mobileMenu').classList.toggle('hidden');
        }

        function toggleSearch() {
            document.getElementById('searchDropdown').classList.toggle('hidden');
        }

        function toggleDateFilter() {
            document.getElementById('dateFilterDropdown').classList.toggle('hidden');
        }

        function toggleInventoryFilter() {
            document.getElementById('inventoryFilterDropdown').classList.toggle('hidden');
        }

        function setDateFilter(filter) {
            const filterTextMap = {
                'all': 'Усі дати',
                'today': 'Сьогодні',
                'week': 'Цей тиждень',
                'month': 'Цей місяць'
            };
            document.getElementById('dateFilterText').textContent = filterTextMap[filter];
            document.getElementById('dateFilterDropdown').classList.add('hidden');
            // Здесь должна быть загрузка данных с новым фильтром
        }

        function setInventoryFilter(filter) {
            const filterTextMap = {
                'all': 'Усі категорії'
                // другие категории будут добавляться динамически
            };
            document.getElementById('inventoryFilterText').textContent = filterTextMap[filter] || filter;
            document.getElementById('inventoryFilterDropdown').classList.add('hidden');
            // Здесь должна быть загрузка данных с новым фильтром
        }

        // Модальные окна
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showAddAppointmentModal() {
            // Загрузка списка клиентов для выпадающего меню
            loadClientsForSelect();
            showModal('addAppointmentModal');
        }

        function showAddClientModal() {
            showModal('addClientModal');
        }

        function showAddMaterialModal() {
            showModal('addMaterialModal');
        }

        function showAddSessionMaterialModal() {
            loadMaterialsForSelect();
            showModal('addSessionMaterialModal');
        }

        function showAddExpenseModal() {
            showModal('addExpenseModal');
        }

        function showIncomeReportModal() {
            showModal('incomeReportModal');
        }

        function showSessionCalculator(appointmentId) {
            // Здесь должна быть загрузка данных о конкретном приеме
            showModal('sessionSection');
        }

        function hideSessionCalculator() {
            hideModal('sessionSection');
        }

        // Загрузка данных
        async function loadInitialData() {
            showLoading();
            try {
                await Promise.all([
                    loadClients(),
                    loadAppointments(),
                    loadMaterials(),
                    loadTransactions()
                ]);
                updateUI();
            } catch (error) {
                console.error('Ошибка загрузки данных:', error);
            } finally {
                hideLoading();
            }
        }

        async function loadClients() {
            const { data, error } = await supabase
                .from('clients')
                .select('*')
                .order('last_name', { ascending: true });
            
            if (error) throw error;
            appData.clients = data;
        }

        async function loadAppointments() {
            const currentDate = new Date().toISOString().split('T')[0];
            
            const { data, error } = await supabase
                .from('appointments')
                .select(`
                    *,
                    clients(first_name, last_name, phone)
                `)
                .gte('date', currentDate)
                .order('date', { ascending: true })
                .order('time', { ascending: true });
            
            if (error) throw error;
            appData.appointments = data;
        }

        async function loadMaterials() {
            const { data, error } = await supabase
                .from('materials')
                .select('*')
                .order('name', { ascending: true });
            
            if (error) throw error;
            appData.materials = data;
            
            // Обновление счетчика материалов
            document.getElementById('materialsCount').textContent = data.length;
        }

        async function loadTransactions() {
            const currentMonth = new Date().toISOString().split('-').slice(0, 2).join('-');
            
            const { data, error } = await supabase
                .from('transactions')
                .select('*')
                .ilike('date', `${currentMonth}%`)
                .order('date', { ascending: false });
            
            if (error) throw error;
            appData.transactions = data;
        }

        async function loadClientsForSelect() {
            const select = document.getElementById('appointmentClient');
            select.innerHTML = '<option value="">Вибрати клієнта...</option>';
            
            appData.clients.forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = `${client.last_name} ${client.first_name}${client.phone ? ` (${client.phone})` : ''}`;
                select.appendChild(option);
            });
            
            // Добавление опции для нового клиента
            const newClientOption = document.createElement('option');
            newClientOption.value = 'new';
            newClientOption.textContent = '+ Додати нового клієнта';
            select.appendChild(newClientOption);
        }

        async function loadMaterialsForSelect() {
            const select = document.getElementById('sessionMaterialSelect');
            select.innerHTML = '<option value="">Вибрати матеріал...</option>';
            
            appData.materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.id;
                option.textContent = `${material.name} (${material.quantity} шт.)`;
                select.appendChild(option);
            });
        }

        // CRUD операции
        async function saveAppointment() {
            const clientId = document.getElementById('appointmentClient').value;
            const date = document.getElementById('appointmentDate').value;
            const time = document.getElementById('appointmentTime').value;
            const duration = document.getElementById('appointmentDuration').value;
            const complexity = document.getElementById('appointmentComplexity').value;
            const notes = document.getElementById('appointmentNotes').value;
            
            if (clientId === 'new') {
                hideModal('addAppointmentModal');
                showAddClientModal();
                return;
            }
            
            if (!clientId || !date || !time) {
                alert('Будь ласка, заповніть обов\'язкові поля');
                return;
            }
            
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('appointments')
                    .insert([
                        { 
                            client_id: clientId,
                            date,
                            time,
                            duration,
                            complexity,
                            notes,
                            status: 'scheduled'
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                appData.appointments.push(data[0]);
                updateUI();
                hideModal('addAppointmentModal');
            } catch (error) {
                console.error('Ошибка сохранения записи:', error);
                alert('Помилка збереження запису');
            } finally {
                hideLoading();
            }
        }

        async function saveClient() {
            const firstName = document.getElementById('clientFirstName').value.trim();
            const lastName = document.getElementById('clientLastName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const email = document.getElementById('clientEmail').value.trim();
            const socials = document.getElementById('clientSocials').value.trim();
            const notes = document.getElementById('clientNotes').value.trim();
            
            if (!firstName || !lastName) {
                alert('Будь ласка, введіть ім\'я та прізвище клієнта');
                return;
            }
            
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('clients')
                    .insert([
                        { 
                            first_name: firstName,
                            last_name: lastName,
                            phone: phone || null,
                            email: email || null,
                            socials: socials || null,
                            notes: notes || null
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                appData.clients.push(data[0]);
                updateUI();
                hideModal('addClientModal');
            } catch (error) {
                console.error('Ошибка сохранения клиента:', error);
                alert('Помилка збереження клієнта');
            } finally {
                hideLoading();
            }
        }

        async function saveMaterial() {
            const name = document.getElementById('materialName').value.trim();
            const category = document.getElementById('materialCategory').value || null;
            const quantity = parseInt(document.getElementById('materialQuantity').value) || 0;
            const price = parseFloat(document.getElementById('materialPrice').value) || 0;
            const description = document.getElementById('materialDescription').value.trim() || null;
            
            if (!name || quantity <= 0 || price <= 0) {
                alert('Будь ласка, заповніть обов\'язкові поля (назва, кількість, ціна)');
                return;
            }
            
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('materials')
                    .insert([
                        { 
                            name,
                            category,
                            quantity,
                            price,
                            description
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                appData.materials.push(data[0]);
                updateUI();
                hideModal('addMaterialModal');
            } catch (error) {
                console.error('Ошибка сохранения материала:', error);
                alert('Помилка збереження матеріалу');
            } finally {
                hideLoading();
            }
        }

        async function saveExpense() {
            const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
            const date = document.getElementById('expenseDate').value;
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value.trim() || null;
            const paymentMethod = document.getElementById('expensePaymentMethod').value;
            
            if (amount <= 0 || !date || !category) {
                alert('Будь ласка, заповніть обов\'язкові поля (сума, дата, категорія)');
                return;
            }
            
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('transactions')
                    .insert([
                        { 
                            amount: -amount, // отрицательное значение для расходов
                            date,
                            category,
                            description,
                            payment_method: paymentMethod,
                            type: 'expense'
                        }
                    ])
                    .select();
                
                if (error) throw error;
                
                appData.transactions.push(data[0]);
                updateUI();
                hideModal('addExpenseModal');
            } catch (error) {
                console.error('Ошибка сохранения расхода:', error);
                alert('Помилка збереження витрати');
            } finally {
                hideLoading();
            }
        }

        // Вспомогательные функции
        function setupEventListeners() {
            // Слушатели для калькулятора сеанса
            document.getElementById('sessionDuration').addEventListener('input', updateSessionCalculation);
            document.getElementById('sessionComplexity').addEventListener('change', updateSessionCalculation);
            
            // Слушатели для выбора материала в сеансе
            document.getElementById('sessionMaterialSelect').addEventListener('change', function() {
                const materialId = this.value;
                if (materialId) {
                    const material = appData.materials.find(m => m.id === materialId);
                    if (material) {
                        document.getElementById('sessionMaterialPrice').value = material.price.toFixed(2);
                    }
                }
            });
        }

        function updateUI() {
            updateAppointmentsList();
            updateClientsTable();
            updateMaterialsTable();
            updateFinancialCharts();
        }

        function updateAppointmentsList() {
            const container = document.getElementById('appointmentsList');
            
            if (appData.appointments.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-calendar-alt text-4xl mb-3"></i>
                        <h3 class="text-lg mb-1">Немає записів</h3>
                        <p class="mb-4 text-sm">Створіть перший запис клієнта</p>
                        <button onclick="showAddAppointmentModal()" class="px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                            <i class="fas fa-plus mr-1"></i> Додати запис
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            appData.appointments.forEach(appointment => {
                const client = appointment.clients;
                const appointmentDate = new Date(`${appointment.date}T${appointment.time}`);
                const formattedDate = appointmentDate.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const formattedTime = appointmentDate.toLocaleTimeString('uk-UA', { hour: '2-digit', minute: '2-digit' });
                
                const card = document.createElement('div');
                card.className = 'bg-gray-800 rounded-lg border border-gray-700 p-4 appointment-card transition-all duration-200 cursor-pointer hover:shadow-lg';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium">${client.last_name} ${client.first_name}</h3>
                        <span class="text-xs bg-amber-900/50 text-amber-400 px-2 py-1 rounded">${appointment.duration} год</span>
                    </div>
                    <div class="text-sm text-gray-400 mb-3">${formattedDate} о ${formattedTime}</div>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <span class="text-xs bg-gray-700 px-2 py-1 rounded mr-2">Складність: ${appointment.complexity}/10</span>
                        </div>
                        <button onclick="showSessionCalculator('${appointment.id}')" class="px-3 py-1 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                            Почати сеанс
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function updateClientsTable() {
            const tbody = document.getElementById('clientsTableBody');
            
            if (appData.clients.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            <div class="py-8">
                                <i class="fas fa-users text-4xl mb-2"></i>
                                <p>База клієнтів порожня</p>
                                <button onclick="showAddClientModal()" class="mt-3 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                                    <i class="fas fa-plus mr-1"></i> Додати клієнта
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            appData.clients.forEach(client => {
                const tr = document.createElement('tr');
                tr.className = 'bg-gray-800 border-b border-gray-700 hover:bg-gray-700';
                tr.innerHTML = `
                    <td scope="row" class="px-6 py-4 font-medium whitespace-nowrap">
                        ${client.last_name} ${client.first_name}
                    </td>
                    <td class="px-6 py-4">
                        ${client.phone || '-'}<br>
                        ${client.email ? `<span class="text-xs text-gray-400">${client.email}</span>` : ''}
                    </td>
                    <td class="px-6 py-4">
                        0
                    </td>
                    <td class="px-6 py-4">
                        -
                    </td>
                    <td class="px-6 py-4">
                        <button class="text-amber-400 hover:text-amber-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-gray-400 hover:text-gray-300">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function updateMaterialsTable() {
            const tbody = document.getElementById('materialsTableBody');
            
            if (appData.materials.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            <div class="py-8">
                                <i class="fas fa-box-open text-4xl mb-2"></i>
                                <p>Немає матеріалів на складі</p>
                                <button onclick="showAddMaterialModal()" class="mt-3 px-4 py-2 bg-amber-600 hover:bg-amber-700 rounded text-sm">
                                    <i class="fas fa-plus mr-1"></i> Додати матеріал
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = '';
            
            appData.materials.forEach(material => {
                const warningClass = material.quantity < 3 ? 'text-red-400' : '';
                
                const tr = document.createElement('tr');
                tr.className = 'bg-gray-800 border-b border-gray-700 hover:bg-gray-700 material-enter';
                tr.innerHTML = `
                    <td scope="row" class="px-6 py-4 font-medium whitespace-nowrap">
                        ${material.name}
                    </td>
                    <td class="px-6 py-4">
                        ${material.category || '-'}
                    </td>
                    <td class="px-6 py-4 ${warningClass}">
                        ${material.quantity} ${warningClass ? '<i class="fas fa-exclamation-circle ml-1"></i>' : ''}
                    </td>
                    <td class="px-6 py-4">
                        ${material.price.toFixed(2)} грн
                    </td>
                    <td class="px-6 py-4">
                        <button class="text-amber-400 hover:text-amber-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-gray-400 hover:text-gray-300">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Функции калькулятора сеанса
        function updateSessionCalculation() {
            const duration = parseFloat(document.getElementById('sessionDuration').value) || 0;
            const hourlyRate = 1000; // Из настроек
            const complexity = parseInt(document.getElementById('sessionComplexity').value) || 5;
            
            // Расчет стоимости по времени
            const timeCost = duration * hourlyRate;
            
            // Расчет наценки за сложность (5% за каждый пункт выше 5)
            const complexityFee = complexity > 5 ? Math.min((complexity - 5) * 5, 25) : 0; // максимум 25%
            const complexityCost = timeCost * (complexityFee / 100);
            
            // Расчет стоимости материалов (уже добавленных)
            let materialsCost = 0;
            const materialItems = document.querySelectorAll('#sessionMaterialsList div[id^="material-"]');
            materialItems.forEach(item => {
                materialsCost += parseFloat(item.dataset.totalPrice) || 0;
            });
            
            // Общая сумма
            const totalCost = timeCost + complexityCost + materialsCost;
            
            // Обновление UI
            document.getElementById('sessionTimeCost').textContent = timeCost.toFixed(2) + ' грн';
            document.getElementById('sessionComplexityFee').textContent = complexityFee > 0 ? `+${complexityFee}%` : '0%';
            document.getElementById('sessionComplexityCost').textContent = complexityCost.toFixed(2) + ' грн';
            document.getElementById('sessionMaterialsCost').textContent = materialsCost.toFixed(2) + ' грн';
            document.getElementById('sessionTotalCost').textContent = totalCost.toFixed(2) + ' грн';
        }

        function addMaterialToSession() {
            const materialId = document.getElementById('sessionMaterialSelect').value;
            const quantity = parseInt(document.getElementById('sessionMaterialQuantity').value) || 1;
            const price = parseFloat(document.getElementById('sessionMaterialPrice').value) || 0;
            const notes = document.getElementById('sessionMaterialNotes').value.trim();
            
            if (!materialId) {
                alert('Будь ласка, виберіть матеріал');
                return;
            }
            
            const material = appData.materials.find(m => m.id === materialId);
            if (!material) return;
            
            const materialsList = document.getElementById('sessionMaterialsList');
            const totalPrice = quantity * price;
            
            // Если список пуст и содержит placeholder, очищаем его
            if (materialsList.innerHTML.includes('не вибрані')) {
                materialsList.innerHTML = '';
            }
            
            const materialDiv = document.createElement('div');
            materialDiv.id = `material-${materialId}`;
            materialDiv.className = 'bg-gray-700 rounded p-3 mb-2 flex justify-between items-center';
            materialDiv.dataset.materialId = materialId;
            materialDiv.dataset.quantity = quantity;
            materialDiv.dataset.price = price;
            materialDiv.dataset.totalPrice = totalPrice.toFixed(2);
            materialDiv.innerHTML = `
                <div>
                    <div class="font-medium">${material.name}</div>
                    <div class="text-xs text-gray-400">${quantity} × ${price.toFixed(2)} грн = ${totalPrice.toFixed(2)} грн</div>
                    ${notes ? `<div class="text-xs mt-1">${notes}</div>` : ''}
                </div>
                <button onclick="removeMaterialFromSession('material-${materialId}')" class="text-gray-400 hover:text-red-400">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            materialsList.appendChild(materialDiv);
            hideModal('addSessionMaterialModal');
            updateSessionCalculation();
        }

        function removeMaterialFromSession(materialId) {
            const materialElement = document.getElementById(materialId);
            if (materialElement) {
                materialElement.remove();
                updateSessionCalculation();
            }
            
            // Если список пуст, показываем placeholder
            const materialsList = document.getElementById('sessionMaterialsList');
            if (materialsList.children.length === 0) {
                materialsList.innerHTML = '<div class="text-center py-4 text-gray-500"><p>Матеріали не вибрані</p></div>';
            }
        }

        async function completeSessionPayment() {
            const paymentMethod = document.getElementById('paymentMethod').value;
            const totalCost = parseFloat(document.getElementById('sessionTotalCost').textContent.replace(' грн', ''));
            const notes = document.getElementById('sessionNotes').value.trim();
            
            if (totalCost <= 0) {
                alert('Сума до сплати має бути більшою за нуль');
                return;
            }
            
            // Здесь сохраняем данные о сеансе в базу данных
            showLoading();
            try {
                // 1. Сохраняем транзакцию (доход)
                const { data: transaction, error: transactionError } = await supabase
                    .from('transactions')
                    .insert([
                        { 
                            amount: totalCost,
                            date: new Date().toISOString().split('T')[0],
                            category: 'tattoo_service',
                            payment_method: paymentMethod,
                            type: 'income',
                            notes: notes || null
                        }
                    ])
                    .select();
                
                if (transactionError) throw transactionError;
                
                // 2. Если есть материалы, обновляем их количество
                const materialItems = document.querySelectorAll('#sessionMaterialsList div[id^="material-"]');
                if (materialItems.length > 0) {
                    const updates = [];
                    
                    materialItems.forEach(item => {
                        const materialId = item.dataset.materialId;
                        const quantityUsed = parseInt(item.dataset.quantity);
                        updates.push({ id: materialId, quantity: quantityUsed });
                    });
                    
                    // Здесь должен быть batch update для всех использованных материалов
                }
                
                // 3. Обновляем статус приема
                // ...
                
                // Успех - обновляем UI и закрываем калькулятор
                appData.transactions.push(transaction[0]);
                updateUI();
                hideSessionCalculator();
            } catch (error) {
                console.error('Ошибка завершения сеанса:', error);
                alert('Помилка завершення сеансу');
            } finally {
                hideLoading();
            }
        }

        // Графики
        function initCharts() {
            // График доходов
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');
            window.incomeChart = new Chart(incomeCtx, {
                type: 'bar',
                data: {
                    labels: Array(30).fill(0).map((_, i) => `${i+1} день`),
                    datasets: [{
                        label: 'Дохід',
                        data: Array(30).fill(0),
                        backgroundColor: 'rgba(245, 158, 11, 0.7)',
                        borderColor: 'rgba(245, 158, 11, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(55, 65, 81, 1)'
                            },
                            ticks: {
                                color: 'rgba(156, 163, 175, 1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(55, 65, 81, 1)'
                            },
                            ticks: {
                                color: 'rgba(156, 163, 175, 1)'
                            }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
            
            // График доходов vs расходов
            const incomeVsExpensesCtx = document.getElementById('incomeVsExpensesChart').getContext('2d');
            window.incomeVsExpensesChart = new Chart(incomeVsExpensesCtx, {
                type: 'line',
                data: {
                    labels: ['Січ', 'Лют', 'Бер', 'Кві', 'Тра', 'Чер', 'Лип', 'Сер', 'Вер', 'Жов', 'Лис', 'Гру'],
                    datasets: [
                        {
                            label: 'Дохід',
                            data: Array(12).fill(0),
                            borderColor: 'rgba(74, 222, 128, 1)',
                            backgroundColor: 'rgba(74, 222, 128, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        },
                        {
                            label: 'Витрати',
                            data: Array(12).fill(0),
                            borderColor: 'rgba(248, 113, 113, 1)',
                            backgroundColor: 'rgba(248, 113, 113, 0.1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: 'rgba(209, 213, 219, 1)'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(55, 65, 81, 1)'
                            },
                            ticks: {
                                color: 'rgba(156, 163, 175, 1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(55, 65, 81, 1)'
                            },
                            ticks: {
                                color: 'rgba(156, 163, 175, 1)'
                            }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
            
            // Круговая диаграмма расходов по категориям
            const expensesByCategoryCtx = document.getElementById('expensesByCategoryChart').getContext('2d');
            window.expensesByCategoryChart = new Chart(expensesByCategoryCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Матеріали', 'Оренда', 'Маркетинг', 'Обладнання', 'Інше'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(167, 139, 250, 0.7)',
                            'rgba(248, 113, 113, 0.7)',
                            'rgba(74, 222, 128, 0.7)',
                            'rgba(96, 165, 250, 0.7)',
                            'rgba(156, 163, 175, 0.7)'
                        ],
                        borderColor: [
                            'rgba(167, 139, 250, 1)',
                            'rgba(248, 113, 113, 1)',
                            'rgba(74, 222, 128, 1)',
                            'rgba(96, 165, 250, 1)',
                            'rgba(156, 163, 175, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'rgba(209, 213, 219, 1)'
                            }
                        }
                    },
                    animation: {
                        duration: 1000
                    }
                }
            });
        }

        function updateFinancialCharts() {
            // Обновляем данные для графиков на основе appData.transactions
            // В реальном приложении здесь должен быть анализ транзакций
            
            // Обновляем круговую диаграмму
            window.expensesByCategoryChart.data.datasets[0].data = [0, 0, 0, 0, 0];
            window.expensesByCategoryChart.update();
            
            // Обновляем график доходов
            window.incomeChart.data.datasets[0].data = Array(30).fill(0).map(() => Math.random() * 5000 + 1000);
            window.incomeChart.update();
            
            // Обновляем график доходы vs расходы
            window.incomeVsExpensesChart.data.datasets[0].data = Array(12).fill(0).map(() => Math.random() * 30000 + 10000);
            window.incomeVsExpensesChart.data.datasets[1].data = Array(12).fill(0).map(() => Math.random() * 15000 + 5000);
            window.incomeVsExpensesChart.update();
        }
    </script>
</body>
</html>
